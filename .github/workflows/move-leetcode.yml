name: Move LeetCode Solutions

on:
  workflow_dispatch:  # 수동 실행 옵션 유지
  push:
    paths:
      - '[0-9][0-9][0-9][0-9]-*/**'  # LeetHub가 생성하는 폴더 패턴 (예: 0020-valid-parentheses)

jobs:
  move-files:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
        with:
          fetch-depth: 0 # 전체 기록을 가져와야 커밋 및 푸시가 안정적으로 동작

      - name: Configure Git
        run: |
          git config --global user.name 'github-actions[bot]'
          git config --global user.email 'github-actions[bot]@users.noreply.github.com'

      - name: Move LeetCode solutions
        id: move
        run: |
          TARGET_PATH="src/main/java/com/codingTest/leetcode"
          
          # 목표 디렉토리가 없다면 생성
          mkdir -p "$TARGET_PATH"
          echo "Target directory created: $TARGET_PATH"
          
          found_move=0
          
          # LeetHub가 생성한 폴더들을 순회합니다. (예: 0020-valid-parentheses)
          for d in [0-9][0-9][0-9][0-9]-*; do
            if [ -d "$d" ]; then
              echo "Moving directory: $d to $TARGET_PATH/"
          
              # 해당 디렉토리를 목표 경로로 이동
              mv "$d" "$TARGET_PATH/"
              found_move=1
            fi
          done
          
          # 이동할 폴더를 찾지 못했을 경우
          if [ $found_move -eq 0 ]; then
            echo "No matching directories found to move."
          fi
          
          # 다음 단계에서 커밋이 필요한지 판단하기 위해 상태 설정
          echo "needs_commit=$found_move" >> $GITHUB_OUTPUT

      - name: Commit & Push changes
        if: steps.move.outputs.needs_commit == '1'
        run: |
          git add -A
          git commit -m "chore: Move LeetCode solutions to $TARGET_PATH"
          git push